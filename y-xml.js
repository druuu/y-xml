/**
 * y-xml - Xml Type for Yjs
 * @version v11.0.0-2
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.yXml=t()}(this,function(){"use strict";function e(e,n,r){if(e==n)return e?[[y,e]]:[];(r<0||e.length<r)&&(r=null);var s=i(e,n),u=e.substring(0,s);e=e.substring(s),n=n.substring(s),s=o(e,n);var c=e.substring(e.length-s);e=e.substring(0,e.length-s),n=n.substring(0,n.length-s);var h=t(e,n);return u&&h.unshift([y,u]),c&&h.push([y,c]),l(h),null!=r&&(h=a(h,r)),h}function t(t,r){var i;if(!t)return[[g,r]];if(!r)return[[v,t]];var o=t.length>r.length?t:r,l=t.length>r.length?r:t,u=o.indexOf(l);if(-1!=u)return i=[[g,o.substring(0,u)],[y,l],[g,o.substring(u+l.length)]],t.length>r.length&&(i[0][0]=i[2][0]=v),i;if(1==l.length)return[[v,t],[g,r]];var a=s(t,r);if(a){var c=a[0],h=a[1],d=a[2],f=a[3],p=a[4],m=e(c,d),_=e(h,f);return m.concat([[y,p]],_)}return n(t,r)}function n(e,t){for(var n=e.length,i=t.length,o=Math.ceil((n+i)/2),s=o,l=2*o,u=new Array(l),a=new Array(l),c=0;c<l;c++)u[c]=-1,a[c]=-1;u[s+1]=0,a[s+1]=0;for(var h=n-i,d=h%2!=0,f=0,p=0,m=0,y=0,_=0;_<o;_++){for(var b=-_+f;b<=_-p;b+=2){var O,w=s+b;O=b==-_||b!=_&&u[w-1]<u[w+1]?u[w+1]:u[w-1]+1;for(var x=O-b;O<n&&x<i&&e.charAt(O)==t.charAt(x);)O++,x++;if(u[w]=O,O>n)p+=2;else if(x>i)f+=2;else if(d){var E=s+h-b;if(E>=0&&E<l&&-1!=a[E]){var k=n-a[E];if(O>=k)return r(e,t,O,x)}}}for(var D=-_+m;D<=_-y;D+=2){var k,E=s+D;k=D==-_||D!=_&&a[E-1]<a[E+1]?a[E+1]:a[E-1]+1;for(var T=k-D;k<n&&T<i&&e.charAt(n-k-1)==t.charAt(i-T-1);)k++,T++;if(a[E]=k,k>n)y+=2;else if(T>i)m+=2;else if(!d){var w=s+h-D;if(w>=0&&w<l&&-1!=u[w]){var O=u[w],x=s+O-w;if(k=n-k,O>=k)return r(e,t,O,x)}}}}return[[v,e],[g,t]]}function r(t,n,r,i){var o=t.substring(0,r),s=n.substring(0,i),l=t.substring(r),u=n.substring(i),a=e(o,s),c=e(l,u);return a.concat(c)}function i(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(o,i)==t.substring(o,i)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i}function o(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(e.length-i,e.length-o)==t.substring(t.length-i,t.length-o)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i}function s(e,t){function n(e,t,n){for(var r,s,l,u,a=e.substring(n,n+Math.floor(e.length/4)),c=-1,h="";-1!=(c=t.indexOf(a,c+1));){var d=i(e.substring(n),t.substring(c)),f=o(e.substring(0,n),t.substring(0,c));h.length<f+d&&(h=t.substring(c-f,c)+t.substring(c,c+d),r=e.substring(0,n-f),s=e.substring(n+d),l=t.substring(0,c-f),u=t.substring(c+d))}return 2*h.length>=e.length?[r,s,l,u,h]:null}var r=e.length>t.length?e:t,s=e.length>t.length?t:e;if(r.length<4||2*s.length<r.length)return null;var l,u=n(r,s,Math.ceil(r.length/4)),a=n(r,s,Math.ceil(r.length/2));if(!u&&!a)return null;l=a?u&&u[4].length>a[4].length?u:a:u;var c,h,d,f;return e.length>t.length?(c=l[0],h=l[1],d=l[2],f=l[3]):(d=l[0],f=l[1],c=l[2],h=l[3]),[c,h,d,f,l[4]]}function l(e){e.push([y,""]);for(var t,n=0,r=0,s=0,u="",a="";n<e.length;)switch(e[n][0]){case g:s++,a+=e[n][1],n++;break;case v:r++,u+=e[n][1],n++;break;case y:r+s>1?(0!==r&&0!==s&&(t=i(a,u),0!==t&&(n-r-s>0&&e[n-r-s-1][0]==y?e[n-r-s-1][1]+=a.substring(0,t):(e.splice(0,0,[y,a.substring(0,t)]),n++),a=a.substring(t),u=u.substring(t)),0!==(t=o(a,u))&&(e[n][1]=a.substring(a.length-t)+e[n][1],a=a.substring(0,a.length-t),u=u.substring(0,u.length-t))),0===r?e.splice(n-s,r+s,[g,a]):0===s?e.splice(n-r,r+s,[v,u]):e.splice(n-r-s,r+s,[v,u],[g,a]),n=n-r-s+(r?1:0)+(s?1:0)+1):0!==n&&e[n-1][0]==y?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,s=0,r=0,u="",a=""}""===e[e.length-1][1]&&e.pop();var c=!1;for(n=1;n<e.length-1;)e[n-1][0]==y&&e[n+1][0]==y&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),c=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),c=!0)),n++;c&&l(e)}function u(e,t){if(0===t)return[y,e];for(var n=0,r=0;r<e.length;r++){var i=e[r];if(i[0]===v||i[0]===y){var o=n+i[1].length;if(t===o)return[r+1,e];if(t<o){e=e.slice();var s=t-n,l=[i[0],i[1].slice(0,s)],u=[i[0],i[1].slice(s)];return e.splice(r,1,l,u),[r+1,e]}n=o}}throw new Error("cursor_pos is out of bounds!")}function a(e,t){var n=u(e,t),r=n[1],i=n[0],o=r[i],s=r[i+1];if(null==o)return e;if(o[0]!==y)return e;if(null!=s&&o[1]+s[1]===s[1]+o[1])return r.splice(i,2,s,o),c(r,i,2);if(null!=s&&0===s[1].indexOf(o[1])){r.splice(i,2,[s[0],o[1]],[0,o[1]]);var l=s[1].slice(o[1].length);return l.length>0&&r.splice(i+2,0,[s[0],l]),c(r,i,3)}return e}function c(e,t,n){for(var r=t+n-1;r>=0&&r>=t-1;r--)if(r+1<e.length){var i=e[r],o=e[r+1];i[0]===o[1]&&e.splice(r,2,[i[0],i[1]+o[1]])}return e}function h(e,t,n){e.requestModules(["Array"]).then(function(){var r=function(e){function r(e,t,n,i){O(this,r);var o=k(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t,n));return null!=i&&null!=i.content&&"_"!==t[0]&&o.insert(0,i.content),o.dom=null,o._domObserver=null,o._domObserverListener=null,null!=i&&null!=i.dom&&o._setDom(i.dom),o}return E(r,e),w(r,[{key:"_setDom",value:function(e){function t(e,t){return e.index<=t?"delete"===e.type?t-Math.min(t-e.index,e.length):t+1:t}var r=this;if(null!=this.dom&&this._unbindFromDom(),null!=e.__yxml&&e.__yxml._unbindFromDom(),null!=n){var i=!0,o=function(e){if(r._domObserver.takeRecords().length>0)throw new Error("These changes should have been collected before!");if(i){i=!1;try{e()}catch(e){throw r._domObserver.takeRecords(),i=!0,e}r._domObserver.takeRecords(),i=!0}};this.observe(function(e){o(function(){var n=null,i=!1,o=null,s=null,l=null,u=null;"undefined"!=typeof getSelection&&(n=getSelection(),n.anchorNode===r.dom&&(o=n.anchorNode,s=t(e,n.anchorOffset),i=!0),n.focusNode===r.dom&&(l=n.focusNode,u=t(e,n.focusOffset),i=!0)),r.dom.nodeValue=r.toString(),i&&n.setBaseAndExtent(o||n.anchorNode,s||n.anchorOffset,l||n.focusNode,u||n.focusOffset)})}),this.dom=e,e.__yxml=this,this._domObserverListener=function(){o(function(){for(var e=b(r.toString(),r.dom.nodeValue),t=0,n=0;n<e.length;n++){var i=e[n];0===i[0]?t+=i[1].length:-1===i[0]?r.delete(t,i[1].length):(r.insert(t,i[1]),t+=i[1].length)}})},this._domObserver=new n(this._domObserverListener),this._domObserver.observe(this.dom,{characterData:!0})}}},{key:"getDom",value:function(){if(null==this.dom){var e=t.createTextNode(this.toString());return null!==n&&this._setDom(e),e}return this.dom}},{key:"toString",value:function(){return this._content.map(function(e){return e.val}).join("")}},{key:"insert",value:function(e,t){x(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"insert",this).call(this,e,t.split(""))}},{key:"_changed",value:regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),e.delegateYield(x(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_changed",this).call(this,t,n),"t0",2);case 2:case"end":return e.stop()}},e,this)})},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){null!=this._eventListenerHandler&&this._eventListenerHandler.destroy(),this._unbindFromDom(),x(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_destroy",this).call(this)}}]),r}(e.Array.typeDefinition.class);e.extend("XmlText",new e.utils.CustomTypeDefinition({name:"XmlText",class:r,struct:"List",parseArguments:function(e){return"string"==typeof e?[this,{content:e}]:e.nodeType===t.TEXT_NODE?[this,{content:e.nodeValue,dom:e}]:[this,{}]},initType:regeneratorRuntime.mark(function t(n,i,o){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=[],t.delegateYield(e.Struct.List.map.call(this,i,function(e){if(e.hasOwnProperty("opContent"))throw new Error("Text must not contain types!");e.content.forEach(function(t,n){s.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})}),"t0",2);case 2:return t.abrupt("return",new r(n,i.id,s,{},o||{}));case 3:case"end":return t.stop()}},t,this)}),createType:function(e,t,n){return new r(e,t.id,[],n||{})}}))})}function d(e){for(var t=Array.prototype.map.call(e.dom.childNodes,function(e){return e.__yxml}).filter(function(e){return void 0!==e}),n=e._content.length-1;n>=0;n--)!function(n){var r=e.get(n);t.some(function(e){return e===r})||e.delete(n,1)}(n);for(var r=e.dom.childNodes,i=r.length,n=0;n<i;n++)!function(t){var n=r[t];if(null!=n.__yxml)if(t<e.length){var i=e.get(t);if(i!==n.__yxml){var o=e._content.findIndex(function(e){return e.type===n.__yxml._model});o<0?n.__yxml=null:e.delete(o,1),e.insertDomElements(t,[n])}}else e.insertDomElements(t,[n]);else e.insertDomElements(t,[n])}(n)}function f(e,t,n){e.requestModules(["Array"]).then(function(){var t=function(t){function r(e,t,n,i){O(this,r);var o=k(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t,n));return o.dom=null,o._domObserver=null,o._domObserverListener=null,o}return E(r,t),w(r,[{key:"insertDomElements",value:function(){return e.XmlElement.typeDefinition.class.prototype.insertDomElements.apply(this,arguments)}},{key:"bindToDom",value:function(e){var t=this;if(null!=this.dom&&this._unbindFromDom(),null!=e.__yxml&&e.__yxml._unbindFromDom(),null==n)throw new Error("Not able to bind to a DOM element, because MutationObserver is not available!");var r=!0,i=function(e){if(t._domObserver.takeRecords().length>0)throw new Error("These changes should have been collected before!");if(r){r=!1;try{e()}catch(e){throw t._domObserver.takeRecords(),r=!0,e}t._domObserver.takeRecords(),r=!0}};e.innerHTML="";for(var o=0;o<this._content.length;o++)e.insertBefore(this.get(o).getDom(),null);this.observe(function(e){i(function(){if("insert"===e.type)for(var n=e.values.map(function(e){return e.getDom()}),r=n.length-1;r>=0;r--){var i=n[r],o=null;t._content.length>e.index+r+1&&(o=t.get(e.index+r+1).getDom()),t.dom.insertBefore(i,o)}else"delete"===e.type&&e.values.forEach(function(e){e.dom.remove()})})}),this.dom=e,e.__yxml=this,this._domObserverListener=function(){i(function(){return d(t)})},this._domObserver=new n(this._domObserverListener),this._domObserver.observe(this.dom,{childList:!0})}},{key:"toString",value:function(){var e=this;return this._content.map(function(t){return e.os.getType(t.type).toString()}).join("")}},{key:"_changed",value:regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),e.delegateYield(x(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_changed",this).call(this,t,n),"t0",2);case 2:case"end":return e.stop()}},e,this)})},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){null!=this._eventListenerHandler&&this._eventListenerHandler.destroy(),this._unbindFromDom(),x(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_destroy",this).call(this)}}]),r}(e.Array.typeDefinition.class);e.extend("XmlFragment",new e.utils.CustomTypeDefinition({name:"XmlFragment",class:t,struct:"List",initType:regeneratorRuntime.mark(function n(r,i){var o,s,l,u;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=[],s=[],n.delegateYield(e.Struct.List.map.call(this,i,function(e){e.hasOwnProperty("opContent")?(o.push({id:e.id,type:e.opContent}),s.push(e.opContent)):e.content.forEach(function(t,n){o.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})}),"t0",3);case 3:l=0;case 4:if(!(l<s.length)){n.next=11;break}return n.delegateYield(this.store.initType.call(this,s[l]),"t1",6);case 6:u=n.t1,u._parent=i.id;case 8:l++,n.next=4;break;case 11:return n.abrupt("return",new t(r,i.id,o));case 12:case"end":return n.stop()}},n,this)}),createType:function(e,n){return new t(e,n.id,[])}}))})}function p(e,t,n){function r(n){if(n.nodeType===t.TEXT_NODE)return e.XmlText(n);if(n.nodeType===t.ELEMENT_NODE)return e.XmlElement(n);throw new Error("Unsupported node!")}function i(t){var n=this;if("Insert"===t.struct){if(this._content.some(function(n){return e.utils.compareIds(n.id,t.id)}))return;var r=void 0;if(null===t.left)r=0;else if((r=1+this._content.findIndex(function(n){return e.utils.compareIds(n.id,t.left)}))<=0)throw new Error("Unexpected operation!");var i,o;if(t.hasOwnProperty("opContent")){this._content.splice(r,0,{id:t.id,type:t.opContent}),o=1;var s=this.os.getType(t.opContent);s._parent=this._model,i=[s]}else{var l=t.content.map(function(e,n){return{id:[t.id[0],t.id[1]+n],val:e}});l.length<3e4?this._content.splice.apply(this._content,[r,0].concat(l)):this._content=this._content.slice(0,r).concat(l).concat(this._content.slice(r)),i=t.content,o=t.content.length}e.utils.bubbleEvent(this,{type:"insert",object:this,index:r,values:i,length:o})}else{if("Delete"!==t.struct)throw new Error("Unexpected struct!");for(var u=0;u<this._content.length&&t.length>0;u++){var a=this._content[u];if(e.utils.inDeletionRange(t,a.id)){var c;for(c=1;c<t.length&&u+c<this._content.length&&e.utils.inDeletionRange(t,this._content[u+c].id);c++);a=this._content[u+c-1],t.length-=a.id[1]-t.target[1]+1,t.target=[a.id[0],a.id[1]+1];var h=this._content.splice(u,c),d=h.map(function(e){return null!=e.val?e.val:n.os.getType(e.type)});e.utils.bubbleEvent(this,{type:"delete",object:this,index:u,values:d,_content:h,length:c})}}}}function o(t){var n,r="Delete"===t.struct?t.key:t.parentSub;if(n=null!=this.opContents[r]?this.os.getType(this.opContents[r]):this.contents[r],"Insert"===t.struct){if(null===t.left&&!e.utils.compareIds(t.id,this.map[r])){var i;null!=t.opContent?(i=this.os.getType(t.opContent),i._parent=this._model,delete this.contents[r],t.deleted?delete this.opContents[r]:this.opContents[r]=t.opContent):(i=t.content[0],delete this.opContents[r],t.deleted?delete this.contents[r]:this.contents[r]=t.content[0]),this.map[r]=t.id,void 0===n?e.utils.bubbleEvent(this,{name:r,object:this,type:"add",value:i}):e.utils.bubbleEvent(this,{name:r,object:this,oldValue:n,type:"update",value:i})}}else{if("Delete"!==t.struct)throw new Error("Unexpected Operation!");e.utils.compareIds(this.map[r],t.target)&&(delete this.opContents[r],delete this.contents[r],e.utils.bubbleEvent(this,{name:r,object:this,oldValue:n,type:"delete"}))}}var s=function(s){function l(t,n,r,s,u,a){O(this,l);var c=k(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));c._os=t,c.os=t,c._model=n.id,c._parent=null,c.map=e.utils.copyObject(n.map),c.contents=s,c.opContents=u,c._content=r,c.nodeName=n.nodeName;var h=o.bind(c),d=i.bind(c),f=new e.utils.EventHandler(function(e){void 0!==e.parentSub||void 0!==e.key?h(e):d(e)});return c.eventHandler=f,c._deepEventHandler=new e.utils.EventListenerHandler,c._eventListenerHandler=f,c._domObserver=null,c._dom=null,null!=a&&c._setDom(a),c}return E(l,s),w(l,[{key:"toString",value:function(){var e=this,t=this.nodeName.toLowerCase(),n=this._content.map(function(t){return e.os.getType(t.type).toString()}).join("");return 0===n.length?"<"+t+"/>":"<"+t+">"+n+"</"+t+">"}},{key:"_getPathToChild",value:function(t){return this._content.findIndex(function(n){return null!=n.type&&e.utils.compareIds(n.type,t)})}},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){this._unbindFromDom(),null!=this._eventListenerHandler&&(this._eventListenerHandler.destroy(),this._eventListenerHandler=null),this.nodeName=null,this._content=null,this.contents=null,this.opContents=null,this.map=null}},{key:"insertDomElements",value:function(e,t){t.forEach(function(e){null!=e.__yxml&&e.__yxml._unbindFromDom()});var n=t.map(r);this.insert(e,n)}},{key:"insert",value:function(t,n){if(!Array.isArray(n))throw new Error("Expected an Array of content!");for(var r=0;r<n.length;r++){var i=n[r],o=e.utils.isTypeDefinition(i);if(null==o||"XmlElement"!==o[0].name&&"XmlText"!==o[0].name)throw new Error("Expected Y.Xml type or String!")}e.Array.typeDefinition.class.prototype.insert.call(this,t,n)}},{key:"delete",value:function(){return e.Array.typeDefinition.class.prototype.delete.apply(this,arguments)}},{key:"get",value:function(){return e.Array.typeDefinition.class.prototype.get.apply(this,arguments)}},{key:"removeAttribute",value:function(){return e.Map.typeDefinition.class.prototype.delete.apply(this,arguments)}},{key:"setAttribute",value:function(){return e.Map.typeDefinition.class.prototype.set.apply(this,arguments)}},{key:"getAttribute",value:function(){return e.Map.typeDefinition.class.prototype.get.apply(this,arguments)}},{key:"getAttributes",value:function(){var t=this,n=e.Map.typeDefinition.class.prototype.keys.apply(this),r={};return n.forEach(function(n){var i=e.Map.typeDefinition.class.prototype.get.call(t,n);null!=i&&(r[n]=i)}),r}},{key:"_bindToDom",value:function(e){var t=this,r=!0,i=function(e){if(t._domObserver.takeRecords().length>0)throw new Error("These changes should have been collected before!");if(r){r=!1;try{e()}catch(e){throw t._domObserver.takeRecords(),r=!0,e}t._domObserver.takeRecords(),r=!0}};return this._mutualExclude=i,this._domObserverListener=function(e){i(function(){var n=!1;e.forEach(function(e){if("attributes"===e.type){var r=e.attributeName,i=e.target.getAttribute(e.attributeName);t.getAttribute(r)!==i&&(null==i?t.removeAttribute(r):t.setAttribute(r,i))}else"childList"===e.type&&(n=!0)}),n&&d(t),t._content.length,t.dom.childNodes.length})},this._domObserver=new n(this._domObserverListener),this._domObserver.observe(e,{attributes:!0,childList:!0}),this.observe(function(n){i(function(){if("attributeChanged"===n.type)e.setAttribute(n.name,n.value);else if("attributeRemoved"===n.type)e.removeAttribute(n.name);else if("childInserted"===n.type)for(var r=n.nodes,i=r.length-1;i>=0;i--){var o=r[i],s=o.getDom(),l=null;t._content.length>n.index+i+1&&(l=t.get(n.index+i+1).getDom()),t.dom.insertBefore(s,l)}else"childRemoved"===n.type&&n.values.forEach(function(e){e.dom.remove()});t._content.length,t.dom.childNodes.length})}),e}},{key:"_setDom",value:function(e){if(null!=this.dom)throw new Error("Only call this method if you know what you are doing ;)");if(null!=e.__yxml)throw new Error("Already bound to an YXml type");e.__yxml=this;for(var t=0;t<e.attributes.length;t++){var i=e.attributes[t];this.setAttribute(i.name,i.value)}return this.insert(0,Array.prototype.map.call(e.childNodes,function(e){return null!=e.__yxml&&(e.__yxml._domObserver.disconnect(),e.__yxml=null),r(e)})),null!=n&&(this.dom=this._bindToDom(e)),e}},{key:"getDom",value:function(){var e=this.dom;if(null==e){e=t.createElement(this.nodeName),e.__yxml=this;var r=this.getAttributes();for(var i in r)e.setAttribute(i,r[i]);for(var o=0;o<this._content.length;o++){var s=this._content[o],l=this.os.getType(s.type);e.appendChild(l.getDom())}null!==n&&(this.dom=this._bindToDom(e))}return e}},{key:"observe",value:function(e){function t(t){if("insert"===t.type)e({type:"childInserted",index:t.index,nodes:t.values});else if("delete"===t.type)e(void 0!==t.index?{type:"childRemoved",index:t.index,values:t.values,_content:t._content}:{type:"attributeRemoved",name:t.name});else{if("update"!==t.type&&"add"!==t.type)throw new Error("Unexpected event");e({type:"attributeChanged",name:t.name,value:t.value})}}return this._eventListenerHandler.addEventListener(t),t}},{key:"unobserve",value:function(e){this._eventListenerHandler.removeEventListener(e)}},{key:"observeDeep",value:function(e){this._deepEventHandler.addEventListener(e)}},{key:"unobserveDeep",value:function(e){this._deepEventHandler.removeEventListener(e)}},{key:"_changed",value:regeneratorRuntime.mark(function t(n,r){var i=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),void 0===r.parentSub&&void 0===r.targetParent){t.next=5;break}return t.delegateYield(e.Map.typeDefinition.class.prototype._changed.apply(this,i),"t0",3);case 3:t.next=6;break;case 5:return t.delegateYield(e.Array.typeDefinition.class.prototype._changed.apply(this,i),"t1",6);case 6:case"end":return t.stop()}},t,this)})},{key:"length",get:function(){return this._content.length}}]),l}(e.utils.CustomType);e.extend("XmlElement",new e.utils.CustomTypeDefinition({name:"XmlElement",class:s,struct:"Xml",parseArguments:function(e){if("string"==typeof e)return[this,{nodeName:e.toUpperCase(),dom:null}];if(e.nodeType===t.ELEMENT_NODE)return[this,{nodeName:e.nodeName,dom:e}];throw new Error("Y.Xml requires an argument which is a string!")},initType:regeneratorRuntime.mark(function t(n,r,i){var o,l,u,a,c,h,d,f,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=[],l=[],t.delegateYield(e.Struct.Xml.map.call(this,r,function(e){e.hasOwnProperty("opContent")?(o.push({id:e.id,type:e.opContent}),l.push(e.opContent)):e.content.forEach(function(t,n){o.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})}),"t0",3);case 3:u=0;case 4:if(!(u<l.length)){t.next=11;break}return t.delegateYield(this.store.initType.call(this,l[u],i),"t1",6);case 6:a=t.t1,a._parent=r.id;case 8:u++,t.next=4;break;case 11:c={},h={},d=r.map,t.t2=regeneratorRuntime.keys(d);case 15:if((t.t3=t.t2()).done){t.next=29;break}return f=t.t3.value,t.delegateYield(this.getOperation(d[f]),"t4",18);case 18:if(p=t.t4,!p.deleted){t.next=21;break}return t.abrupt("continue",15);case 21:if(null==p.opContent){t.next=26;break}return h[f]=p.opContent,t.delegateYield(this.store.initType.call(this,p.opContent),"t5",24);case 24:t.next=27;break;case 26:c[f]=p.content[0];case 27:t.next=15;break;case 29:return t.abrupt("return",new s(n,r,o,c,h,null!=i?i.dom:null));case 30:case"end":return t.stop()}},t,this)}),createType:function(e,t,n){return new s(e,t,[],{},{},n.dom)}}))}function m(e,t,n){null==t&&"undefined"!=typeof document&&(t=document),"undefined"!=typeof MutationObserver?n=MutationObserver:(console.warn("MutationObserver is not available. y-xml won't listen to changes on the DOM"),n=null),p(e,t,n),h(e,t,n),f(e,t,n)}var v=-1,g=1,y=0,_=e;_.INSERT=g,_.DELETE=v,_.EQUAL=y;var b=_,O=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},w=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),x=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},E=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},k=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};return"undefined"!=typeof Y&&m(Y),m});
//# sourceMappingURL=y-xml.js.map
