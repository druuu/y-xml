/**
 * y-xml - Xml Type for Yjs
 * @version v11.0.0-5
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.yXml=e()}(this,function(){"use strict";function t(t,n,r){if(t==n)return t?[[O,t]]:[];(r<0||t.length<r)&&(r=null);var l=i(t,n),u=t.substring(0,l);t=t.substring(l),n=n.substring(l),l=o(t,n);var h=t.substring(t.length-l);t=t.substring(0,t.length-l),n=n.substring(0,n.length-l);var d=e(t,n);return u&&d.unshift([O,u]),h&&d.push([O,h]),s(d),null!=r&&(d=a(d,r)),d=c(d)}function e(e,r){var i;if(!e)return[[b,r]];if(!r)return[[g,e]];var o=e.length>r.length?e:r,s=e.length>r.length?r:e,u=o.indexOf(s);if(-1!=u)return i=[[b,o.substring(0,u)],[O,s],[b,o.substring(u+s.length)]],e.length>r.length&&(i[0][0]=i[2][0]=g),i;if(1==s.length)return[[g,e],[b,r]];var a=l(e,r);if(a){var c=a[0],h=a[1],d=a[2],f=a[3],p=a[4],m=t(c,d),v=t(h,f);return m.concat([[O,p]],v)}return n(e,r)}function n(t,e){for(var n=t.length,i=e.length,o=Math.ceil((n+i)/2),l=o,s=2*o,u=new Array(s),a=new Array(s),c=0;c<s;c++)u[c]=-1,a[c]=-1;u[l+1]=0,a[l+1]=0;for(var h=n-i,d=h%2!=0,f=0,p=0,m=0,v=0,y=0;y<o;y++){for(var _=-y+f;_<=y-p;_+=2){var O,E=l+_;O=_==-y||_!=y&&u[E-1]<u[E+1]?u[E+1]:u[E-1]+1;for(var D=O-_;O<n&&D<i&&t.charAt(O)==e.charAt(D);)O++,D++;if(u[E]=O,O>n)p+=2;else if(D>i)f+=2;else if(d){var x=l+h-_;if(x>=0&&x<s&&-1!=a[x]){var w=n-a[x];if(O>=w)return r(t,e,O,D)}}}for(var k=-y+m;k<=y-v;k+=2){var w,x=l+k;w=k==-y||k!=y&&a[x-1]<a[x+1]?a[x+1]:a[x-1]+1;for(var A=w-k;w<n&&A<i&&t.charAt(n-w-1)==e.charAt(i-A-1);)w++,A++;if(a[x]=w,w>n)v+=2;else if(A>i)m+=2;else if(!d){var E=l+h-k;if(E>=0&&E<s&&-1!=u[E]){var O=u[E],D=l+O-E;if(w=n-w,O>=w)return r(t,e,O,D)}}}}return[[g,t],[b,e]]}function r(e,n,r,i){var o=e.substring(0,r),l=n.substring(0,i),s=e.substring(r),u=n.substring(i),a=t(o,l),c=t(s,u);return a.concat(c)}function i(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,o=0;n<i;)t.substring(o,i)==e.substring(o,i)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i}function o(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,o=0;n<i;)t.substring(t.length-i,t.length-o)==e.substring(e.length-i,e.length-o)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i}function l(t,e){function n(t,e,n){for(var r,l,s,u,a=t.substring(n,n+Math.floor(t.length/4)),c=-1,h="";-1!=(c=e.indexOf(a,c+1));){var d=i(t.substring(n),e.substring(c)),f=o(t.substring(0,n),e.substring(0,c));h.length<f+d&&(h=e.substring(c-f,c)+e.substring(c,c+d),r=t.substring(0,n-f),l=t.substring(n+d),s=e.substring(0,c-f),u=e.substring(c+d))}return 2*h.length>=t.length?[r,l,s,u,h]:null}var r=t.length>e.length?t:e,l=t.length>e.length?e:t;if(r.length<4||2*l.length<r.length)return null;var s,u=n(r,l,Math.ceil(r.length/4)),a=n(r,l,Math.ceil(r.length/2));if(!u&&!a)return null;s=a?u&&u[4].length>a[4].length?u:a:u;var c,h,d,f;return t.length>e.length?(c=s[0],h=s[1],d=s[2],f=s[3]):(d=s[0],f=s[1],c=s[2],h=s[3]),[c,h,d,f,s[4]]}function s(t){t.push([O,""]);for(var e,n=0,r=0,l=0,u="",a="";n<t.length;)switch(t[n][0]){case b:l++,a+=t[n][1],n++;break;case g:r++,u+=t[n][1],n++;break;case O:r+l>1?(0!==r&&0!==l&&(e=i(a,u),0!==e&&(n-r-l>0&&t[n-r-l-1][0]==O?t[n-r-l-1][1]+=a.substring(0,e):(t.splice(0,0,[O,a.substring(0,e)]),n++),a=a.substring(e),u=u.substring(e)),0!==(e=o(a,u))&&(t[n][1]=a.substring(a.length-e)+t[n][1],a=a.substring(0,a.length-e),u=u.substring(0,u.length-e))),0===r?t.splice(n-l,r+l,[b,a]):0===l?t.splice(n-r,r+l,[g,u]):t.splice(n-r-l,r+l,[g,u],[b,a]),n=n-r-l+(r?1:0)+(l?1:0)+1):0!==n&&t[n-1][0]==O?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,l=0,r=0,u="",a=""}""===t[t.length-1][1]&&t.pop();var c=!1;for(n=1;n<t.length-1;)t[n-1][0]==O&&t[n+1][0]==O&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),c=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),c=!0)),n++;c&&s(t)}function u(t,e){if(0===e)return[O,t];for(var n=0,r=0;r<t.length;r++){var i=t[r];if(i[0]===g||i[0]===O){var o=n+i[1].length;if(e===o)return[r+1,t];if(e<o){t=t.slice();var l=e-n,s=[i[0],i[1].slice(0,l)],u=[i[0],i[1].slice(l)];return t.splice(r,1,s,u),[r+1,t]}n=o}}throw new Error("cursor_pos is out of bounds!")}function a(t,e){var n=u(t,e),r=n[1],i=n[0],o=r[i],l=r[i+1];if(null==o)return t;if(o[0]!==O)return t;if(null!=l&&o[1]+l[1]===l[1]+o[1])return r.splice(i,2,l,o),h(r,i,2);if(null!=l&&0===l[1].indexOf(o[1])){r.splice(i,2,[l[0],o[1]],[0,o[1]]);var s=l[1].slice(o[1].length);return s.length>0&&r.splice(i+2,0,[l[0],s]),h(r,i,3)}return t}function c(t){for(var e=!1,n=function(t){return t.charCodeAt(0)>=56320&&t.charCodeAt(0)<=57343},r=2;r<t.length;r+=1)t[r-2][0]===O&&function(t){return t.charCodeAt(t.length-1)>=55296&&t.charCodeAt(t.length-1)<=56319}(t[r-2][1])&&t[r-1][0]===g&&n(t[r-1][1])&&t[r][0]===b&&n(t[r][1])&&(e=!0,t[r-1][1]=t[r-2][1].slice(-1)+t[r-1][1],t[r][1]=t[r-2][1].slice(-1)+t[r][1],t[r-2][1]=t[r-2][1].slice(0,-1));if(!e)return t;for(var i=[],r=0;r<t.length;r+=1)t[r][1].length>0&&i.push(t[r]);return i}function h(t,e,n){for(var r=e+n-1;r>=0&&r>=e-1;r--)if(r+1<t.length){var i=t[r],o=t[r+1];i[0]===o[1]&&t.splice(r,2,[i[0],i[1]+o[1]])}return t}function d(t,e){return t.index<=e?"delete"===t.type?e-Math.min(e-t.index,t.length):e+1:e}function f(t,e,n){t.requestModules(["Array"]).then(function(){var r=function(t){function r(t,e,n,i){x(this,r);var o=T(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e,n));null!=i&&null!=i.content&&"_"!==e[0]&&o.insert(0,i.content),o.dom=null,o._domObserver=null,o._domObserverListener=null,null!=i&&null!=i.dom&&o._setDom(i.dom);var l=!0;return o._mutualExcluse=function(t){if(l){l=!1;try{t()}catch(t){console.error(t)}o._domObserver.takeRecords(),l=!0}},o.observe(function(t){null!=o.dom&&o._mutualExcluse(function(){var e=null,n=!1,r=null,i=null,l=null,s=null;"undefined"!=typeof getSelection&&(e=getSelection(),e.anchorNode===o.dom&&(r=e.anchorNode,i=d(t,e.anchorOffset),n=!0),e.focusNode===o.dom&&(l=e.focusNode,s=d(t,e.focusOffset),n=!0)),o.dom.nodeValue=o.toString(),n&&e.setBaseAndExtent(r||e.anchorNode,i||e.anchorOffset,l||e.focusNode,s||e.focusOffset)})}),o}return A(r,t),w(r,[{key:"setDomFilter",value:function(){}},{key:"_setDom",value:function(t){var e=this;null!=this.dom&&this._unbindFromDom(),null!=t.__yxml&&t.__yxml._unbindFromDom(),null!=n&&(this.dom=t,t.__yxml=this,this._domObserverListener=function(){e._mutualExcluse(function(){for(var t=D(e.toString(),e.dom.nodeValue),n=0,r=0;r<t.length;r++){var i=t[r];0===i[0]?n+=i[1].length:-1===i[0]?e.delete(n,i[1].length):(e.insert(n,i[1]),n+=i[1].length)}})},this._domObserver=new n(this._domObserverListener),this._domObserver.observe(this.dom,{characterData:!0}))}},{key:"getDom",value:function(){if(null==this.dom){var t=e.createTextNode(this.toString());return null!==n&&this._setDom(t),t}return this.dom}},{key:"toString",value:function(){return this._content.map(function(t){return t.val}).join("")}},{key:"insert",value:function(t,e){k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"insert",this).call(this,t,e.split(""))}},{key:"_changed",value:function(t,e){null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_changed",this).call(this,t,e)}},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){null!=this._eventListenerHandler&&this._eventListenerHandler.destroy(),this._unbindFromDom(),k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_destroy",this).call(this)}}]),r}(t.Array.typeDefinition.class);t.extend("XmlText",new t.utils.CustomTypeDefinition({name:"XmlText",class:r,struct:"List",parseArguments:function(t){return"string"==typeof t?[this,{content:t}]:t.nodeType===e.TEXT_NODE?[this,{content:t.nodeValue,dom:t}]:[this,{}]},initType:function(e,n,i){var o=[];return t.Struct.List.map.call(this,n,function(t){if(t.hasOwnProperty("opContent"))throw new Error("Text must not contain types!");t.content.forEach(function(e,n){o.push({id:[t.id[0],t.id[1]+n],val:t.content[n]})})}),new r(e,n.id,o,{},i||{})},createType:function(t,e,n){return new r(t,e.id,[],n||{})}}))})}function p(t,e){return e}function m(t){for(var e=Array.prototype.map.call(t.dom.childNodes,function(t){return t.__yxml}).filter(function(t){return void 0!==t}),n=t._content.length-1;n>=0;n--)!function(n){var r=t.get(n);e.some(function(t){return t===r})||t.delete(n,1)}(n);for(var r=t.dom.childNodes,i=r.length,o=0,l=0;o<i;o++){(function(e,n){var i=r[e];if(null!=i.__yxml){if(!1===i.__yxml)return"continue";if(n<t.length){if(t.get(n)!==i.__yxml){var o=t._content.findIndex(function(t){return t.type[0]===i.__yxml._model[0]&&t.type[1]===i.__yxml._model[1]});o<0?i.__yxml=null:t.delete(o,1),n+=t.insertDomElements(n,[i])}else n++}else n+=t.insertDomElements(n,[i])}else n+=t.insertDomElements(n,[i]);l=n})(o,l)}}function v(t,e,n){t.requestModules(["Array"]).then(function(){var e=function(e){function r(t,e,n,i){x(this,r);var o=T(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e,n));o.dom=null,o._domObserver=null,o._domObserverListener=null,o._domFilter=p;var l=!0;return o._mutualExcluse=function(t){if(l){l=!1;try{t()}catch(t){console.error(t)}o._domObserver.takeRecords(),l=!0}},o.observe(function(t){null!=o.dom&&o._mutualExcluse(function(){if("insert"===t.type)for(var e=t.values.length-1;e>=0;e--){var n=t.values[e];n.setDomFilter(o._domFilter);var r=n.getDom(),i=null;o._content.length>t.index+e+1&&(i=o.get(t.index+e+1).getDom()),o.dom.insertBefore(r,i)}else"delete"===t.type&&t.values.forEach(function(t){t.dom.remove()})})}),o}return A(r,e),w(r,[{key:"setDomFilter",value:function(t){this._domFilter=t,this.toArray().forEach(function(e){e.setDomFilter(t)})}},{key:"insertDomElements",value:function(){return t.XmlElement.typeDefinition.class.prototype.insertDomElements.apply(this,arguments)}},{key:"bindToDom",value:function(t){var e=this;if(null!=this.dom&&this._unbindFromDom(),null!=t.__yxml&&t.__yxml._unbindFromDom(),null==n)throw new Error("Not able to bind to a DOM element, because MutationObserver is not available!");t.innerHTML="";for(var r=0;r<this._content.length;r++)t.insertBefore(this.get(r).getDom(),null);this.dom=t,t.__yxml=this,this._domObserverListener=function(){e._mutualExcluse(function(){return m(e)})},this._domObserver=new n(this._domObserverListener),this._domObserver.takeRecords(),this._domObserver.observe(this.dom,{childList:!0})}},{key:"toString",value:function(){var t=this;return this._content.map(function(e){return t.os.getType(e.type).toString()}).join("")}},{key:"_changed",value:function(t,e){null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_changed",this).call(this,t,e)}},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){null!=this._eventListenerHandler&&this._eventListenerHandler.destroy(),this._unbindFromDom(),k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_destroy",this).call(this)}}]),r}(t.Array.typeDefinition.class);t.extend("XmlFragment",new t.utils.CustomTypeDefinition({name:"XmlFragment",class:e,struct:"List",initType:function(n,r){var i=[],o=[];t.Struct.List.map.call(this,r,function(t){t.hasOwnProperty("opContent")?(i.push({id:t.id,type:t.opContent}),o.push(t.opContent)):t.content.forEach(function(e,n){i.push({id:[t.id[0],t.id[1]+n],val:t.content[n]})})});for(var l=0;l<o.length;l++){this.store.initType.call(this,o[l])._parent=r.id}return new e(n,r.id,i)},createType:function(t,n){return new e(t,n.id,[])}}))})}function y(t,e,n){function r(e){var n=this;if("Insert"===e.struct){if(this._content.some(function(n){return t.utils.compareIds(n.id,e.id)}))return;var r=void 0;if(null===e.left)r=0;else if((r=1+this._content.findIndex(function(n){return t.utils.compareIds(n.id,e.left)}))<=0)throw new Error("Unexpected operation!");var i,o;if(e.hasOwnProperty("opContent")){this._content.splice(r,0,{id:e.id,type:e.opContent}),o=1;var l=this.os.getType(e.opContent);l._parent=this._model,i=[l]}else{var s=e.content.map(function(t,n){return{id:[e.id[0],e.id[1]+n],val:t}});s.length<3e4?this._content.splice.apply(this._content,[r,0].concat(s)):this._content=this._content.slice(0,r).concat(s).concat(this._content.slice(r)),i=e.content,o=e.content.length}t.utils.bubbleEvent(this,{type:"insert",object:this,index:r,values:i,length:o})}else{if("Delete"!==e.struct)throw new Error("Unexpected struct!");for(var u=0;u<this._content.length&&e.length>0;u++){var a=this._content[u];if(t.utils.inDeletionRange(e,a.id)){var c;for(c=1;c<e.length&&u+c<this._content.length&&t.utils.inDeletionRange(e,this._content[u+c].id);c++);a=this._content[u+c-1],e.length-=a.id[1]-e.target[1]+1,e.target=[a.id[0],a.id[1]+1];var h=this._content.splice(u,c),d=h.map(function(t){return null!=t.val?t.val:n.os.getType(t.type)});t.utils.bubbleEvent(this,{type:"delete",object:this,index:u,values:d,_content:h,length:c})}}}}function i(e){var n,r="Delete"===e.struct?e.key:e.parentSub;if(n=null!=this.opContents[r]?this.os.getType(this.opContents[r]):this.contents[r],"Insert"===e.struct){if(null===e.left&&!t.utils.compareIds(e.id,this.map[r])){var i;null!=e.opContent?(i=this.os.getType(e.opContent),i._parent=this._model,delete this.contents[r],e.deleted?delete this.opContents[r]:this.opContents[r]=e.opContent):(i=e.content[0],delete this.opContents[r],e.deleted?delete this.contents[r]:this.contents[r]=e.content[0]),this.map[r]=e.id,void 0===n?t.utils.bubbleEvent(this,{name:r,object:this,type:"add",value:i}):t.utils.bubbleEvent(this,{name:r,object:this,oldValue:n,type:"update",value:i})}}else{if("Delete"!==e.struct)throw new Error("Unexpected Operation!");t.utils.compareIds(this.map[r],e.target)&&(delete this.opContents[r],delete this.contents[r],t.utils.bubbleEvent(this,{name:r,object:this,oldValue:n,type:"delete"}))}}var o=function(o){function l(e,n,o,s,u,a,c){x(this,l);var h=T(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));h._os=e,h.os=e,h._model=n.id,h._parent=null,h.map=t.utils.copyObject(n.map),h.contents=s,h.opContents=u,h._content=o,h.nodeName=n.nodeName;var d=i.bind(h),f=r.bind(h),p=new t.utils.EventHandler(function(t){void 0!==t.parentSub||void 0!==t.key?d(t):f(t)});h.eventHandler=p,h._deepEventHandler=new t.utils.EventListenerHandler,h._eventListenerHandler=p,h._domObserver=null,h.dom=null,h._domFilter=c,null!=a&&h._setDom(a);var m=!0;return h._mutualExclude=function(t){if(m){m=!1;try{t()}catch(t){console.error(t)}h._domObserver.takeRecords(),m=!0}},h.observe(function(t){null!=h.dom&&h._mutualExclude(function(){if("attributeChanged"===t.type)h.dom.setAttribute(t.name,t.value);else if("attributeRemoved"===t.type)h.dom.removeAttribute(t.name);else if("childInserted"===t.type)for(var e=t.nodes,n=e.length-1;n>=0;n--){var r=e[n];r.setDomFilter(h._domFilter);var i=r.getDom(),o=null;h._content.length>t.index+n+1&&(o=h.get(t.index+n+1).getDom()),h.dom.insertBefore(i,o)}else"childRemoved"===t.type&&t.values.forEach(function(t){t.dom.remove()})})}),h}return A(l,o),w(l,[{key:"setDomFilter",value:function(t){this._domFilter=t;for(var e=this._content.length,n=0;n<e;n++)this.get(n).setDomFilter(t)}},{key:"toString",value:function(){var t=this,e=this.nodeName.toLowerCase(),n=this._content.map(function(e){return t.os.getType(e.type).toString()}).join("");return 0===n.length?"<"+e+"/>":"<"+e+">"+n+"</"+e+">"}},{key:"_getPathToChild",value:function(e){return this._content.findIndex(function(n){return null!=n.type&&t.utils.compareIds(n.type,e)})}},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){this._unbindFromDom(),null!=this._eventListenerHandler&&(this._eventListenerHandler.destroy(),this._eventListenerHandler=null),this.nodeName=null,this._content=null,this.contents=null,this.opContents=null,this.map=null}},{key:"insertDomElements",value:function(n,r){var i=this,o=[];return r.forEach(function(n){if(null!=n.__yxml&&!1!==n.__yxml&&n.__yxml._unbindFromDom(),null!==i._domFilter(n,[])){var r=void 0;if(n.nodeType===e.TEXT_NODE)r=t.XmlText(n,i._domFilter);else{if(n.nodeType!==e.ELEMENT_NODE)throw new Error("Unsupported node!");r=t.XmlElement(n,i._domFilter)}o.push(r)}else n.__yxml=!1}),this.insert(n,o),o.length}},{key:"insert",value:function(e,n){if(!Array.isArray(n))throw new Error("Expected an Array of content!");for(var r=0;r<n.length;r++){var i=n[r],o=t.utils.isTypeDefinition(i);if(null==o||"XmlElement"!==o[0].name&&"XmlText"!==o[0].name)throw new Error("Expected Y.Xml type or String!")}t.Array.typeDefinition.class.prototype.insert.call(this,e,n)}},{key:"delete",value:function(){return t.Array.typeDefinition.class.prototype.delete.apply(this,arguments)}},{key:"get",value:function(){return t.Array.typeDefinition.class.prototype.get.apply(this,arguments)}},{key:"removeAttribute",value:function(){return t.Map.typeDefinition.class.prototype.delete.apply(this,arguments)}},{key:"setAttribute",value:function(){return t.Map.typeDefinition.class.prototype.set.apply(this,arguments)}},{key:"getAttribute",value:function(){return t.Map.typeDefinition.class.prototype.get.apply(this,arguments)}},{key:"getAttributes",value:function(){var e=this,n=t.Map.typeDefinition.class.prototype.keys.apply(this),r={};return n.forEach(function(n){var i=t.Map.typeDefinition.class.prototype.get.call(e,n);null!=i&&(r[n]=i)}),r}},{key:"_bindToDom",value:function(t){var e=this;return this._domObserverListener=function(t){e._mutualExclude(function(){var n=!1;t.forEach(function(t){if("attributes"===t.type){var r=t.attributeName;if(e._domFilter(e.dom,[r]).length>0){var i=t.target.getAttribute(r);e.getAttribute(r)!==i&&(null==i?e.removeAttribute(r):e.setAttribute(r,i))}}else"childList"===t.type&&(n=!0)}),n&&m(e)})},this._domObserver=new n(this._domObserverListener),this._domObserver.observe(t,{attributes:!0,childList:!0}),t}},{key:"_setDom",value:function(t){if(null!=this.dom)throw new Error("Only call this method if you know what you are doing ;)");if(null!=t.__yxml)throw new Error("Already bound to an YXml type");t.__yxml=this;for(var e=[],r=0;r<t.attributes.length;r++)e.push(t.attributes[r].name);e=this._domFilter(t,e);for(var i=0;i<e.length;i++){var o=e[i],l=t.getAttribute(o);this.setAttribute(o,l)}return this.insertDomElements(0,Array.prototype.slice.call(t.childNodes)),null!=n&&(this.dom=this._bindToDom(t)),t}},{key:"getDom",value:function(){var t=this.dom;if(null==t){t=e.createElement(this.nodeName),t.__yxml=this;var r=this.getAttributes();for(var i in r)t.setAttribute(i,r[i]);for(var o=0;o<this._content.length;o++){var l=this._content[o],s=this.os.getType(l.type);t.appendChild(s.getDom())}null!==n&&(this.dom=this._bindToDom(t))}return t}},{key:"observe",value:function(t){function e(e){if("insert"===e.type)t({type:"childInserted",index:e.index,nodes:e.values});else if("delete"===e.type)t(void 0!==e.index?{type:"childRemoved",index:e.index,values:e.values,_content:e._content}:{type:"attributeRemoved",name:e.name});else{if("update"!==e.type&&"add"!==e.type)throw new Error("Unexpected event");t({type:"attributeChanged",name:e.name,value:e.value})}}return this._eventListenerHandler.addEventListener(e),e}},{key:"unobserve",value:function(t){this._eventListenerHandler.removeEventListener(t)}},{key:"observeDeep",value:function(t){this._deepEventHandler.addEventListener(t)}},{key:"unobserveDeep",value:function(t){this._deepEventHandler.removeEventListener(t)}},{key:"_changed",value:function(e,n){null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),void 0!==n.parentSub||void 0!==n.targetParent?t.Map.typeDefinition.class.prototype._changed.apply(this,arguments):t.Array.typeDefinition.class.prototype._changed.apply(this,arguments)}},{key:"length",get:function(){return this._content.length}}]),l}(t.utils.CustomType);t.extend("XmlElement",new t.utils.CustomTypeDefinition({name:"XmlElement",class:o,struct:"Xml",parseArguments:function(t,n){var r=void 0;if(r="function"==typeof n?n:p,"string"==typeof t)return[this,{nodeName:t.toUpperCase(),dom:null,domFilter:r}];if(t.nodeType===e.ELEMENT_NODE)return[this,{nodeName:t.nodeName,dom:t,domFilter:r}];throw new Error("Y.XmlElement requires an argument which is a string!")},initType:function(e,n,r){var i=[],l=[];t.Struct.Xml.map.call(this,n,function(t){t.hasOwnProperty("opContent")?(i.push({id:t.id,type:t.opContent}),l.push(t.opContent)):t.content.forEach(function(e,n){i.push({id:[t.id[0],t.id[1]+n],val:t.content[n]})})});for(var s=0;s<l.length;s++){this.store.initType.call(this,l[s],r)._parent=n.id}var u={},a={},c=n.map;for(var h in c){var d=this.getOperation(c[h]);d.deleted||(null!=d.opContent?(a[h]=d.opContent,this.store.initType.call(this,d.opContent)):u[h]=d.content[0])}return new o(e,n,i,u,a,null!=r?r.dom:null,null!=r?r.domFilter:p)},createType:function(t,e,n){return new o(t,e,[],{},{},n.dom,n.domFilter)}}))}function _(t,e,n){null==e&&"undefined"!=typeof document&&(e=document),n="undefined"!=typeof MutationObserver?MutationObserver:null,y(t,e,n),f(t,e,n),v(t,e,n)}var g=-1,b=1,O=0,E=t;E.INSERT=b,E.DELETE=g,E.EQUAL=O;var D=E,x=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},w=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),k=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var l=i.get;if(void 0!==l)return l.call(r)},A=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},T=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};return"undefined"!=typeof Y&&_(Y),_});
//# sourceMappingURL=y-xml.js.map
