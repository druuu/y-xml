/**
 * y-xml - Xml Type for Yjs
 * @version v11.0.0-4
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.yXml=t()}(this,function(){"use strict";function e(e,n,r){if(e==n)return e?[[O,e]]:[];(r<0||e.length<r)&&(r=null);var s=o(e,n),u=e.substring(0,s);e=e.substring(s),n=n.substring(s),s=i(e,n);var h=e.substring(e.length-s);e=e.substring(0,e.length-s),n=n.substring(0,n.length-s);var d=t(e,n);return u&&d.unshift([O,u]),h&&d.push([O,h]),l(d),null!=r&&(d=a(d,r)),d=c(d)}function t(t,r){var o;if(!t)return[[b,r]];if(!r)return[[g,t]];var i=t.length>r.length?t:r,l=t.length>r.length?r:t,u=i.indexOf(l);if(-1!=u)return o=[[b,i.substring(0,u)],[O,l],[b,i.substring(u+l.length)]],t.length>r.length&&(o[0][0]=o[2][0]=g),o;if(1==l.length)return[[g,t],[b,r]];var a=s(t,r);if(a){var c=a[0],h=a[1],d=a[2],f=a[3],p=a[4],m=e(c,d),v=e(h,f);return m.concat([[O,p]],v)}return n(t,r)}function n(e,t){for(var n=e.length,o=t.length,i=Math.ceil((n+o)/2),s=i,l=2*i,u=new Array(l),a=new Array(l),c=0;c<l;c++)u[c]=-1,a[c]=-1;u[s+1]=0,a[s+1]=0;for(var h=n-o,d=h%2!=0,f=0,p=0,m=0,v=0,y=0;y<i;y++){for(var _=-y+f;_<=y-p;_+=2){var O,E=s+_;O=_==-y||_!=y&&u[E-1]<u[E+1]?u[E+1]:u[E-1]+1;for(var D=O-_;O<n&&D<o&&e.charAt(O)==t.charAt(D);)O++,D++;if(u[E]=O,O>n)p+=2;else if(D>o)f+=2;else if(d){var x=s+h-_;if(x>=0&&x<l&&-1!=a[x]){var w=n-a[x];if(O>=w)return r(e,t,O,D)}}}for(var k=-y+m;k<=y-v;k+=2){var w,x=s+k;w=k==-y||k!=y&&a[x-1]<a[x+1]?a[x+1]:a[x-1]+1;for(var T=w-k;w<n&&T<o&&e.charAt(n-w-1)==t.charAt(o-T-1);)w++,T++;if(a[x]=w,w>n)v+=2;else if(T>o)m+=2;else if(!d){var E=s+h-k;if(E>=0&&E<l&&-1!=u[E]){var O=u[E],D=s+O-E;if(w=n-w,O>=w)return r(e,t,O,D)}}}}return[[g,e],[b,t]]}function r(t,n,r,o){var i=t.substring(0,r),s=n.substring(0,o),l=t.substring(r),u=n.substring(o),a=e(i,s),c=e(l,u);return a.concat(c)}function o(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),o=r,i=0;n<o;)e.substring(i,o)==t.substring(i,o)?(n=o,i=n):r=o,o=Math.floor((r-n)/2+n);return o}function i(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),o=r,i=0;n<o;)e.substring(e.length-o,e.length-i)==t.substring(t.length-o,t.length-i)?(n=o,i=n):r=o,o=Math.floor((r-n)/2+n);return o}function s(e,t){function n(e,t,n){for(var r,s,l,u,a=e.substring(n,n+Math.floor(e.length/4)),c=-1,h="";-1!=(c=t.indexOf(a,c+1));){var d=o(e.substring(n),t.substring(c)),f=i(e.substring(0,n),t.substring(0,c));h.length<f+d&&(h=t.substring(c-f,c)+t.substring(c,c+d),r=e.substring(0,n-f),s=e.substring(n+d),l=t.substring(0,c-f),u=t.substring(c+d))}return 2*h.length>=e.length?[r,s,l,u,h]:null}var r=e.length>t.length?e:t,s=e.length>t.length?t:e;if(r.length<4||2*s.length<r.length)return null;var l,u=n(r,s,Math.ceil(r.length/4)),a=n(r,s,Math.ceil(r.length/2));if(!u&&!a)return null;l=a?u&&u[4].length>a[4].length?u:a:u;var c,h,d,f;return e.length>t.length?(c=l[0],h=l[1],d=l[2],f=l[3]):(d=l[0],f=l[1],c=l[2],h=l[3]),[c,h,d,f,l[4]]}function l(e){e.push([O,""]);for(var t,n=0,r=0,s=0,u="",a="";n<e.length;)switch(e[n][0]){case b:s++,a+=e[n][1],n++;break;case g:r++,u+=e[n][1],n++;break;case O:r+s>1?(0!==r&&0!==s&&(t=o(a,u),0!==t&&(n-r-s>0&&e[n-r-s-1][0]==O?e[n-r-s-1][1]+=a.substring(0,t):(e.splice(0,0,[O,a.substring(0,t)]),n++),a=a.substring(t),u=u.substring(t)),0!==(t=i(a,u))&&(e[n][1]=a.substring(a.length-t)+e[n][1],a=a.substring(0,a.length-t),u=u.substring(0,u.length-t))),0===r?e.splice(n-s,r+s,[b,a]):0===s?e.splice(n-r,r+s,[g,u]):e.splice(n-r-s,r+s,[g,u],[b,a]),n=n-r-s+(r?1:0)+(s?1:0)+1):0!==n&&e[n-1][0]==O?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,s=0,r=0,u="",a=""}""===e[e.length-1][1]&&e.pop();var c=!1;for(n=1;n<e.length-1;)e[n-1][0]==O&&e[n+1][0]==O&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),c=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),c=!0)),n++;c&&l(e)}function u(e,t){if(0===t)return[O,e];for(var n=0,r=0;r<e.length;r++){var o=e[r];if(o[0]===g||o[0]===O){var i=n+o[1].length;if(t===i)return[r+1,e];if(t<i){e=e.slice();var s=t-n,l=[o[0],o[1].slice(0,s)],u=[o[0],o[1].slice(s)];return e.splice(r,1,l,u),[r+1,e]}n=i}}throw new Error("cursor_pos is out of bounds!")}function a(e,t){var n=u(e,t),r=n[1],o=n[0],i=r[o],s=r[o+1];if(null==i)return e;if(i[0]!==O)return e;if(null!=s&&i[1]+s[1]===s[1]+i[1])return r.splice(o,2,s,i),h(r,o,2);if(null!=s&&0===s[1].indexOf(i[1])){r.splice(o,2,[s[0],i[1]],[0,i[1]]);var l=s[1].slice(i[1].length);return l.length>0&&r.splice(o+2,0,[s[0],l]),h(r,o,3)}return e}function c(e){for(var t=!1,n=function(e){return e.charCodeAt(0)>=56320&&e.charCodeAt(0)<=57343},r=2;r<e.length;r+=1)e[r-2][0]===O&&function(e){return e.charCodeAt(e.length-1)>=55296&&e.charCodeAt(e.length-1)<=56319}(e[r-2][1])&&e[r-1][0]===g&&n(e[r-1][1])&&e[r][0]===b&&n(e[r][1])&&(t=!0,e[r-1][1]=e[r-2][1].slice(-1)+e[r-1][1],e[r][1]=e[r-2][1].slice(-1)+e[r][1],e[r-2][1]=e[r-2][1].slice(0,-1));if(!t)return e;for(var o=[],r=0;r<e.length;r+=1)e[r][1].length>0&&o.push(e[r]);return o}function h(e,t,n){for(var r=t+n-1;r>=0&&r>=t-1;r--)if(r+1<e.length){var o=e[r],i=e[r+1];o[0]===i[1]&&e.splice(r,2,[o[0],o[1]+i[1]])}return e}function d(e,t){return e.index<=t?"delete"===e.type?t-Math.min(t-e.index,e.length):t+1:t}function f(e,t,n){e.requestModules(["Array"]).then(function(){var r=function(e){function r(e,t,n,o){x(this,r);var i=A(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t,n));null!=o&&null!=o.content&&"_"!==t[0]&&i.insert(0,o.content),i.dom=null,i._domObserver=null,i._domObserverListener=null,null!=o&&null!=o.dom&&i._setDom(o.dom);var s=!0;return i._mutualExcluse=function(e){if(i._domObserver.takeRecords().length>0)throw new Error("These changes should have been collected before!");if(s){s=!1;try{e()}catch(e){throw i._domObserver.takeRecords(),s=!0,e}i._domObserver.takeRecords(),s=!0}},i.observe(function(e){null!=i.dom&&i._mutualExcluse(function(){var t=null,n=!1,r=null,o=null,s=null,l=null;"undefined"!=typeof getSelection&&(t=getSelection(),t.anchorNode===i.dom&&(r=t.anchorNode,o=d(e,t.anchorOffset),n=!0),t.focusNode===i.dom&&(s=t.focusNode,l=d(e,t.focusOffset),n=!0)),i.dom.nodeValue=i.toString(),n&&t.setBaseAndExtent(r||t.anchorNode,o||t.anchorOffset,s||t.focusNode,l||t.focusOffset)})}),i}return T(r,e),w(r,[{key:"setDomFilter",value:function(){}},{key:"_setDom",value:function(e){var t=this;null!=this.dom&&this._unbindFromDom(),null!=e.__yxml&&e.__yxml._unbindFromDom(),null!=n&&(this.dom=e,e.__yxml=this,this._domObserverListener=function(){t._mutualExcluse(function(){for(var e=D(t.toString(),t.dom.nodeValue),n=0,r=0;r<e.length;r++){var o=e[r];0===o[0]?n+=o[1].length:-1===o[0]?t.delete(n,o[1].length):(t.insert(n,o[1]),n+=o[1].length)}})},this._domObserver=new n(this._domObserverListener),this._domObserver.observe(this.dom,{characterData:!0}))}},{key:"getDom",value:function(){if(null==this.dom){var e=t.createTextNode(this.toString());return null!==n&&this._setDom(e),e}return this.dom}},{key:"toString",value:function(){return this._content.map(function(e){return e.val}).join("")}},{key:"insert",value:function(e,t){k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"insert",this).call(this,e,t.split(""))}},{key:"_changed",value:function(e,t){null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_changed",this).call(this,e,t)}},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){null!=this._eventListenerHandler&&this._eventListenerHandler.destroy(),this._unbindFromDom(),k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_destroy",this).call(this)}}]),r}(e.Array.typeDefinition.class);e.extend("XmlText",new e.utils.CustomTypeDefinition({name:"XmlText",class:r,struct:"List",parseArguments:function(e){return"string"==typeof e?[this,{content:e}]:e.nodeType===t.TEXT_NODE?[this,{content:e.nodeValue,dom:e}]:[this,{}]},initType:function(t,n,o){var i=[];return e.Struct.List.map.call(this,n,function(e){if(e.hasOwnProperty("opContent"))throw new Error("Text must not contain types!");e.content.forEach(function(t,n){i.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})}),new r(t,n.id,i,{},o||{})},createType:function(e,t,n){return new r(e,t.id,[],n||{})}}))})}function p(e,t){return t}function m(e){for(var t=Array.prototype.map.call(e.dom.childNodes,function(e){return e.__yxml}).filter(function(e){return void 0!==e}),n=e._content.length-1;n>=0;n--)!function(n){var r=e.get(n);t.some(function(e){return e===r})||e.delete(n,1)}(n);for(var r=e.dom.childNodes,o=r.length,i=0,s=0;i<o;i++){(function(t,n){var o=r[t];if(null!=o.__yxml){if(!1===o.__yxml)return"continue";if(n<e.length){if(e.get(n)!==o.__yxml){var i=e._content.findIndex(function(e){return e.type[0]===o.__yxml._model[0]&&e.type[1]===o.__yxml._model[1]});i<0?o.__yxml=null:e.delete(i,1),n+=e.insertDomElements(n,[o])}else n++}else n+=e.insertDomElements(n,[o])}else n+=e.insertDomElements(n,[o]);s=n})(i,s)}}function v(e,t,n){e.requestModules(["Array"]).then(function(){var t=function(t){function r(e,t,n,o){x(this,r);var i=A(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t,n));i.dom=null,i._domObserver=null,i._domObserverListener=null,i._domFilter=p;var s=!0;return i._mutualExcluse=function(e){if(i._domObserver.takeRecords().length>0)throw new Error("These changes should have been collected before!");if(s){s=!1;try{e()}catch(e){throw i._domObserver.takeRecords(),s=!0,e}i._domObserver.takeRecords(),s=!0}},i.observe(function(e){null!=i.dom&&i._mutualExcluse(function(){if("insert"===e.type)for(var t=e.values.length-1;t>=0;t--){var n=e.values[t];n.setDomFilter(i._domFilter);var r=n.getDom(),o=null;i._content.length>e.index+t+1&&(o=i.get(e.index+t+1).getDom()),i.dom.insertBefore(r,o)}else"delete"===e.type&&e.values.forEach(function(e){e.dom.remove()})})}),i}return T(r,t),w(r,[{key:"setDomFilter",value:function(e){this._domFilter=e,this.toArray().forEach(function(t){t.setDomFilter(e)})}},{key:"insertDomElements",value:function(){return e.XmlElement.typeDefinition.class.prototype.insertDomElements.apply(this,arguments)}},{key:"bindToDom",value:function(e){var t=this;if(null!=this.dom&&this._unbindFromDom(),null!=e.__yxml&&e.__yxml._unbindFromDom(),null==n)throw new Error("Not able to bind to a DOM element, because MutationObserver is not available!");e.innerHTML="";for(var r=0;r<this._content.length;r++)e.insertBefore(this.get(r).getDom(),null);this.dom=e,e.__yxml=this,this._domObserverListener=function(){t._mutualExcluse(function(){return m(t)})},this._domObserver=new n(this._domObserverListener),this._domObserver.takeRecords(),this._domObserver.observe(this.dom,{childList:!0})}},{key:"toString",value:function(){var e=this;return this._content.map(function(t){return e.os.getType(t.type).toString()}).join("")}},{key:"_changed",value:function(e,t){null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_changed",this).call(this,e,t)}},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){null!=this._eventListenerHandler&&this._eventListenerHandler.destroy(),this._unbindFromDom(),k(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_destroy",this).call(this)}}]),r}(e.Array.typeDefinition.class);e.extend("XmlFragment",new e.utils.CustomTypeDefinition({name:"XmlFragment",class:t,struct:"List",initType:function(n,r){var o=[],i=[];e.Struct.List.map.call(this,r,function(e){e.hasOwnProperty("opContent")?(o.push({id:e.id,type:e.opContent}),i.push(e.opContent)):e.content.forEach(function(t,n){o.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})});for(var s=0;s<i.length;s++){this.store.initType.call(this,i[s])._parent=r.id}return new t(n,r.id,o)},createType:function(e,n){return new t(e,n.id,[])}}))})}function y(e,t,n){function r(t){var n=this;if("Insert"===t.struct){if(this._content.some(function(n){return e.utils.compareIds(n.id,t.id)}))return;var r=void 0;if(null===t.left)r=0;else if((r=1+this._content.findIndex(function(n){return e.utils.compareIds(n.id,t.left)}))<=0)throw new Error("Unexpected operation!");var o,i;if(t.hasOwnProperty("opContent")){this._content.splice(r,0,{id:t.id,type:t.opContent}),i=1;var s=this.os.getType(t.opContent);s._parent=this._model,o=[s]}else{var l=t.content.map(function(e,n){return{id:[t.id[0],t.id[1]+n],val:e}});l.length<3e4?this._content.splice.apply(this._content,[r,0].concat(l)):this._content=this._content.slice(0,r).concat(l).concat(this._content.slice(r)),o=t.content,i=t.content.length}e.utils.bubbleEvent(this,{type:"insert",object:this,index:r,values:o,length:i})}else{if("Delete"!==t.struct)throw new Error("Unexpected struct!");for(var u=0;u<this._content.length&&t.length>0;u++){var a=this._content[u];if(e.utils.inDeletionRange(t,a.id)){var c;for(c=1;c<t.length&&u+c<this._content.length&&e.utils.inDeletionRange(t,this._content[u+c].id);c++);a=this._content[u+c-1],t.length-=a.id[1]-t.target[1]+1,t.target=[a.id[0],a.id[1]+1];var h=this._content.splice(u,c),d=h.map(function(e){return null!=e.val?e.val:n.os.getType(e.type)});e.utils.bubbleEvent(this,{type:"delete",object:this,index:u,values:d,_content:h,length:c})}}}}function o(t){var n,r="Delete"===t.struct?t.key:t.parentSub;if(n=null!=this.opContents[r]?this.os.getType(this.opContents[r]):this.contents[r],"Insert"===t.struct){if(null===t.left&&!e.utils.compareIds(t.id,this.map[r])){var o;null!=t.opContent?(o=this.os.getType(t.opContent),o._parent=this._model,delete this.contents[r],t.deleted?delete this.opContents[r]:this.opContents[r]=t.opContent):(o=t.content[0],delete this.opContents[r],t.deleted?delete this.contents[r]:this.contents[r]=t.content[0]),this.map[r]=t.id,void 0===n?e.utils.bubbleEvent(this,{name:r,object:this,type:"add",value:o}):e.utils.bubbleEvent(this,{name:r,object:this,oldValue:n,type:"update",value:o})}}else{if("Delete"!==t.struct)throw new Error("Unexpected Operation!");e.utils.compareIds(this.map[r],t.target)&&(delete this.opContents[r],delete this.contents[r],e.utils.bubbleEvent(this,{name:r,object:this,oldValue:n,type:"delete"}))}}var i=function(i){function s(t,n,i,l,u,a,c){x(this,s);var h=A(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));h._os=t,h.os=t,h._model=n.id,h._parent=null,h.map=e.utils.copyObject(n.map),h.contents=l,h.opContents=u,h._content=i,h.nodeName=n.nodeName;var d=o.bind(h),f=r.bind(h),p=new e.utils.EventHandler(function(e){void 0!==e.parentSub||void 0!==e.key?d(e):f(e)});h.eventHandler=p,h._deepEventHandler=new e.utils.EventListenerHandler,h._eventListenerHandler=p,h._domObserver=null,h.dom=null,h._domFilter=c,null!=a&&h._setDom(a);var m=!0;return h._mutualExclude=function(e){if(h._domObserver.takeRecords().length>0)throw new Error("These changes should have been collected before!");if(m){m=!1;try{e()}catch(e){throw h._domObserver.takeRecords(),m=!0,e}h._domObserver.takeRecords(),m=!0}},h.observe(function(e){null!=h.dom&&h._mutualExclude(function(){if("attributeChanged"===e.type)h.dom.setAttribute(e.name,e.value);else if("attributeRemoved"===e.type)h.dom.removeAttribute(e.name);else if("childInserted"===e.type)for(var t=e.nodes,n=t.length-1;n>=0;n--){var r=t[n];r.setDomFilter(h._domFilter);var o=r.getDom(),i=null;h._content.length>e.index+n+1&&(i=h.get(e.index+n+1).getDom()),h.dom.insertBefore(o,i)}else"childRemoved"===e.type&&e.values.forEach(function(e){e.dom.remove()})})}),h}return T(s,i),w(s,[{key:"setDomFilter",value:function(e){this._domFilter=e;for(var t=this._content.length,n=0;n<t;n++)this.get(n).setDomFilter(e)}},{key:"toString",value:function(){var e=this,t=this.nodeName.toLowerCase(),n=this._content.map(function(t){return e.os.getType(t.type).toString()}).join("");return 0===n.length?"<"+t+"/>":"<"+t+">"+n+"</"+t+">"}},{key:"_getPathToChild",value:function(t){return this._content.findIndex(function(n){return null!=n.type&&e.utils.compareIds(n.type,t)})}},{key:"_unbindFromDom",value:function(){null!=this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),null!=this.dom&&(this.dom.__yxml=null,this.dom=null)}},{key:"_destroy",value:function(){this._unbindFromDom(),null!=this._eventListenerHandler&&(this._eventListenerHandler.destroy(),this._eventListenerHandler=null),this.nodeName=null,this._content=null,this.contents=null,this.opContents=null,this.map=null}},{key:"insertDomElements",value:function(n,r){var o=this,i=[];return r.forEach(function(n){if(null!=n.__yxml&&!1!==n.__yxml&&n.__yxml._unbindFromDom(),null!==o._domFilter(n,[])){var r=void 0;if(n.nodeType===t.TEXT_NODE)r=e.XmlText(n,o._domFilter);else{if(n.nodeType!==t.ELEMENT_NODE)throw new Error("Unsupported node!");r=e.XmlElement(n,o._domFilter)}i.push(r)}else n.__yxml=!1}),this.insert(n,i),i.length}},{key:"insert",value:function(t,n){if(!Array.isArray(n))throw new Error("Expected an Array of content!");for(var r=0;r<n.length;r++){var o=n[r],i=e.utils.isTypeDefinition(o);if(null==i||"XmlElement"!==i[0].name&&"XmlText"!==i[0].name)throw new Error("Expected Y.Xml type or String!")}e.Array.typeDefinition.class.prototype.insert.call(this,t,n)}},{key:"delete",value:function(){return e.Array.typeDefinition.class.prototype.delete.apply(this,arguments)}},{key:"get",value:function(){return e.Array.typeDefinition.class.prototype.get.apply(this,arguments)}},{key:"removeAttribute",value:function(){return e.Map.typeDefinition.class.prototype.delete.apply(this,arguments)}},{key:"setAttribute",value:function(){return e.Map.typeDefinition.class.prototype.set.apply(this,arguments)}},{key:"getAttribute",value:function(){return e.Map.typeDefinition.class.prototype.get.apply(this,arguments)}},{key:"getAttributes",value:function(){var t=this,n=e.Map.typeDefinition.class.prototype.keys.apply(this),r={};return n.forEach(function(n){var o=e.Map.typeDefinition.class.prototype.get.call(t,n);null!=o&&(r[n]=o)}),r}},{key:"_bindToDom",value:function(e){var t=this;return this._domObserverListener=function(e){t._mutualExclude(function(){var n=!1;e.forEach(function(e){if("attributes"===e.type){var r=e.attributeName;if(t._domFilter(t.dom,[r]).length>0){var o=e.target.getAttribute(r);t.getAttribute(r)!==o&&(null==o?t.removeAttribute(r):t.setAttribute(r,o))}}else"childList"===e.type&&(n=!0)}),n&&m(t)})},this._domObserver=new n(this._domObserverListener),this._domObserver.observe(e,{attributes:!0,childList:!0}),e}},{key:"_setDom",value:function(e){if(null!=this.dom)throw new Error("Only call this method if you know what you are doing ;)");if(null!=e.__yxml)throw new Error("Already bound to an YXml type");e.__yxml=this;for(var t=[],r=0;r<e.attributes.length;r++)t.push(e.attributes[r].name);t=this._domFilter(e,t);for(var o=0;o<t.length;o++){var i=t[o],s=e.getAttribute(i);this.setAttribute(i,s)}return this.insertDomElements(0,Array.prototype.slice.call(e.childNodes)),null!=n&&(this.dom=this._bindToDom(e)),e}},{key:"getDom",value:function(){var e=this.dom;if(null==e){e=t.createElement(this.nodeName),e.__yxml=this;var r=this.getAttributes();for(var o in r)e.setAttribute(o,r[o]);for(var i=0;i<this._content.length;i++){var s=this._content[i],l=this.os.getType(s.type);e.appendChild(l.getDom())}null!==n&&(this.dom=this._bindToDom(e))}return e}},{key:"observe",value:function(e){function t(t){if("insert"===t.type)e({type:"childInserted",index:t.index,nodes:t.values});else if("delete"===t.type)e(void 0!==t.index?{type:"childRemoved",index:t.index,values:t.values,_content:t._content}:{type:"attributeRemoved",name:t.name});else{if("update"!==t.type&&"add"!==t.type)throw new Error("Unexpected event");e({type:"attributeChanged",name:t.name,value:t.value})}}return this._eventListenerHandler.addEventListener(t),t}},{key:"unobserve",value:function(e){this._eventListenerHandler.removeEventListener(e)}},{key:"observeDeep",value:function(e){this._deepEventHandler.addEventListener(e)}},{key:"unobserveDeep",value:function(e){this._deepEventHandler.removeEventListener(e)}},{key:"_changed",value:function(t,n){null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),void 0!==n.parentSub||void 0!==n.targetParent?e.Map.typeDefinition.class.prototype._changed.apply(this,arguments):e.Array.typeDefinition.class.prototype._changed.apply(this,arguments)}},{key:"length",get:function(){return this._content.length}}]),s}(e.utils.CustomType);e.extend("XmlElement",new e.utils.CustomTypeDefinition({name:"XmlElement",class:i,struct:"Xml",parseArguments:function(e,n){var r=void 0;if(r="function"==typeof n?n:p,"string"==typeof e)return[this,{nodeName:e.toUpperCase(),dom:null,domFilter:r}];if(e.nodeType===t.ELEMENT_NODE)return[this,{nodeName:e.nodeName,dom:e,domFilter:r}];throw new Error("Y.XmlElement requires an argument which is a string!")},initType:function(t,n,r){var o=[],s=[];e.Struct.Xml.map.call(this,n,function(e){e.hasOwnProperty("opContent")?(o.push({id:e.id,type:e.opContent}),s.push(e.opContent)):e.content.forEach(function(t,n){o.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})});for(var l=0;l<s.length;l++){this.store.initType.call(this,s[l],r)._parent=n.id}var u={},a={},c=n.map;for(var h in c){var d=this.getOperation(c[h]);d.deleted||(null!=d.opContent?(a[h]=d.opContent,this.store.initType.call(this,d.opContent)):u[h]=d.content[0])}return new i(t,n,o,u,a,null!=r?r.dom:null,null!=r?r.domFilter:p)},createType:function(e,t,n){return new i(e,t,[],{},{},n.dom,n.domFilter)}}))}function _(e,t,n){null==t&&"undefined"!=typeof document&&(t=document),n="undefined"!=typeof MutationObserver?MutationObserver:null,y(e,t,n),f(e,t,n),v(e,t,n)}var g=-1,b=1,O=0,E=e;E.INSERT=b,E.DELETE=g,E.EQUAL=O;var D=E,x=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},w=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),k=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(r)},T=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},A=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};return"undefined"!=typeof Y&&_(Y),_});
//# sourceMappingURL=y-xml.js.map
